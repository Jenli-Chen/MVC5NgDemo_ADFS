
Code Camp Demonstration app
Hybrid MVC / AngularJS mini-SPA app

A) - set up initial structure of application

1) Create MVCDemo web app - MVC + WebAPI with No Authentication
2) Rename solution to MVC5NgDemo, rename project file
3) Package Updates
	bootstrap to 3.2
	Mvc to 5.2.2 (also gets Razor to 3.2.2, WebPages to 3.2.2)
	Newtonsoft.Json 6.0.6
	jQuery to 2.1.1
	WebApi.WebHost to 5.2.2 (also gets WebApi.Client WebApi.Core)
	WebApi to 5.2.2
	WebApi.HelpPage to 5.2.2
	(updates _ViewStart.cshtml)
4) Added Packages
	EntityFramework 6.1.1
	AngularJS.Route 1.3.0
	gets AngularJS.Core 1.3.0
5) Separated out views for _TopNav and _Footer
6) Added render section "headend" to _Layout
7) Moved meta for viewport down
8) Uninstalled Modernizr
9) Enabled HTTPS, updated default URL
10) Edited homepage to be more informative for demo
--Commit to GitHub

11) Added projects with model(s) and Entity Framework repository for persistent data
12) Created API folder for WebApi controllers, moved ValuesController there
13) Added references to Model and EFDAL assemblies
14) Added Rehearsals controller for WebApi
15) Added connection string to web.config
--Commit to GitHub

** In order for this to work, create database MVCDemo (or whatever you want to call it) using SSMS
** OR change the connection string to create a local database
** Run script Schema1_Initial.sql from BGoodMusic.EFDAL\BGM_SqlScripts
** OR let EF create the table automagically
** Then use Visual Studio or SSMS to manually add some entries to the Rehearsals table
** Change the name of the database in the connection string in web.config to match your database name

16) Switched to Attribute Routing, added /demo/ to URL paths
	(this allows separation of cookies between front-end and WebAPI)
	Add MapMvcAttributeRoutes in RouteConfig.cs
17) Added routing rules to Home controller
18) Added Root Hit Redirect rule in web.config
19) Added RehearsalListItem under new folder ViewModels
20) Added Music controller and code in Index method to show list of rehearsals from server side
21) Added menu entry in _TopNav
--Commit to GitHub

*******************************************
PART B - Adding Auth for MVC App using ADFS
*******************************************
1) Renamed solution and project files to help keep things straight between different solutions
2) Add Startup class to web project
3) Install packages
	Microsoft.Owin.Security.WsFederation (3.0.0)
		also gets
		Owin (1.0.0)
		Microsoft.Owin (3.0.0)
		Microsoft.Owin.Security (3.0.0)
		System.IdentityModel.Tokens.Jwt (4.0.0)
		Microsoft.IdentityModel.Protocol.Extensions (1.0.0)
	Microsoft.Owin.Security.Cookies (3.0.0)
	Microsoft.Owin.Security.OAuth (3.0.0)
	Microsoft.Owin.Host.SystemWeb (3.0.0)
	(Added dependentAssembly "Microsoft.Owin" in web.config)
	(reordered references in .csproj for easier comparison)
	(updated port #'s in csproj to differentiate from MVC5NgDemo, from which this was copied
	 updated IISExpressSSLPort to match)

4) Add using statements to Startup
	Microsoft.Owin
	Owin
5) Added Auth controller, with Login, LoggedIn and Logout actions
6) Added View for LoggedIn
7) Added Test controller
8) In Startup - Add app.UseCookieAuthentication
9) In Startup - Add app.UseWsFederationAuthentication
10) In ADFS, Add Relying Party Trust
	Enter data about the relying party manually - Next
	Enter the Display Name, and any Notes that will be helpful - Next
	AD FS profile - Next
	No token encryption - Next
	WS-Federation - add endpoint (from app properties in VS, plus "demo" used with routing) - Next
		https://localhost:44306/demo/
	Relying party trust identifier - value put into web.config key "ast:realmADFSId" - Next
		(using urn makes this easier to differentiate, but could be URL or URI)
	I do not want to configure multi-factor ... at this time - Next
	Permit all users to access this relying party - Next
	Summary tabs - Next
	Leave "Open the Edit Claim Rules dialog" checked, click Close

11) In ADFS, add Claim Rules in "Edit Claim Rules" dialog
	Click "Add Rule..."
	Use default "Send LDAP Attributes as Claims" - Next
	Claim Rule Name - "Basic Claims"
	Attribute store: Active Directory
	LDAP Attribute: "SAM-Account-Name" -- Outgoing: "Name ID"
	Display-Name -- "Name"
	Click "Finish"
	Click OK

12) In Filter Config, add AuthorizeAttribute
13) In Home controller, add AllowAnonymous to Index method
14) Add _LoginPartial to Shared Views, add @Html.Partial for same to _TopNav
16) Test by starting app and clicking on "Rehearsals (MVC)"
17) Added ClientInfo action to Tests controller, related ViewModels and View
18) Added Link to ClientInfo on Tests index page
